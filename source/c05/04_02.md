## 4.02 模块 file/dir

Node.js 提供一组类似 UNIX（POSIX）标准的文件操作API fs 模块。           

文件模块方法参考： <https://nodejs.org/api/fs.html>    

##### 1. 异步同步
fs 模块中的方法有同步和异步。例如读取文件内容的 同步函数fs.readFile() 和 异步函数fs.readFileSync()。          
异步的方法函数的 最后一个参数为回调函数，回调函数的第一个参数包含了错误信息error。      
建议大家用异步，比起同步，异步方法性能更高，速度更快，而且没有阻塞。

```
# vim input.txt
菜鸟教程官网地址：www.runoob.com
文件读取实例


# vim file.js
var fs = require("fs");

// 异步读取
fs.readFile('input.txt', function (err, data) {
   if (err) {
       return console.error(err);
   }
   console.log("异步读取: " + data.toString());
});

// 同步读取
var data = fs.readFileSync('input.txt');
console.log("同步读取: " + data.toString());

console.log("程序执行完毕。");

# node file.js 
同步读取: 菜鸟教程官网地址：www.runoob.com
文件读取实例

程序执行完毕。
异步读取: 菜鸟教程官网地址：www.runoob.com
文件读取实例
```

##### 2. 常用 目录命令
```
1. fs.readdir(path, callback(err, files))   // 读取目录，输出一般调用forEach

2. fs.rmdir(path, callback)   // 删除目录

----------------------
var fs = require("fs");

// 执行前创建一个空的 /tmp/test 目录
console.log("准备删除目录 /tmp/test");
fs.rmdir("/tmp/test",function(err){
   if (err) {
       return console.error(err);
   }
   console.log("读取 /tmp 目录");
   fs.readdir("/tmp/",function(err, files){
      if (err) {
          return console.error(err);
      }
      files.forEach( function (file){
          console.log( file );
      });
   });
});

```


##### 3. 常用 文件命令
```
1. fs.writeFile(file, data[, option], callback)   

file      写入的 文件名或文件描述符
data      要写入文件的数据，可以是 String(字符串) 或 Buffer(缓冲) 对象
options   该参数是一个对象，包含 {encoding, mode, flag}。默认编码为 utf8, 模式为 0666 ， flag 为 'w'
callback  回调函数，回调函数只包含错误信息参数(err)，在写入失败时返回。


2. fs.open(path, flags[, mode], callback)

path      要打开文件的路径
flags     文件打开的行为 r读取、r+读写、rs+同步读写、w写入、wx文件存在写入失败、a追加、ax、ax+
mode      设置文件模式(权限)，文件创建默认权限为 0666(可读，可写)。
callback  回调函数，带有两个参数如：callback(err, fd)。


3. fs.read(fd, buffer, offset, length, position, callback)

fd   通过 fs.open() 方法返回的文件描述符
buffer   数据写入的缓冲区
offset   缓冲区写入的写入偏移量
length   要从文件中读取的字节数
position   文件读取的起始位置，如果 position 的值为 null，则会从当前文件指针的位置读取
callback   回调函数，有三个参数(err, bytesRead, buffer) bytesRead读取的字节数，buffer缓冲区对象


4. fs.ftruncate(fd, len, callback)    截取文件

fd  通过 fs.open() 方法返回的文件描述符
len   文件内容截取的长度
callback  回调函数，没有参数


5. fs.close(fd, callback)     关闭文件，callback回调函数，没有参数

6. fs.unlink(path, callback)  删除文件，callback 回调函数，没有参数

7. fs.stat(path, callback)   

callback带有两个参数如 (err, stats), stats 是 fs.Stats 对象
stats.isFile()	  如果是文件返回 true，否则返回 false。
stats.isDirectory()	 如果是目录返回 true，否则返回 false。
stats.isBlockDevice()  如果是块设备返回 true，否则返回 false。
stats.isCharacterDevice()	如果是字符设备返回 true，否则返回 false。
stats.isSymbolicLink()	如果是软链接返回 true，否则返回 false。
stats.isSocket()	如果是 Socket 返回 true，否则返回 false。
stats.isFIFO()	如果是FIFO，返回true，否则返回 false。FIFO是UNIX中的一种特殊类型的命令管道。


-----------------------------
var fs = require("fs");
var buf = new Buffer.alloc(1024);

function write(file) {
    console.log("0. 准备写入文件");

    fs.writeFile(file, '我是通过 fs.writeFile 写入文件的内容',  function(err) {
       if (err) {
           return console.error(err);
       }
       console.log("0. 数据写入成功！");
    });
    
}


function file_read(file) {
    console.log("\n1. 准备打开已存在的文件！");
    fs.open('input.txt', 'r+', function(err, fd) {
        if (err) {
            return console.error(err);
        }
        console.log("1. 文件打开成功！");

        console.log("\n2. 截取10字节内的文件内容，超出部分将被去除。");
        fs.ftruncate(fd, 20, function(err){
           if (err){
              console.log(err);
           } 
           console.log("2. 文件截取成功。");

           console.log("\n3. 读取文件输出"); 
           fs.read(fd, buf, 0, buf.length, 0, function(err, bytes){
              if (err){
                 console.log(err);
              }

               if(bytes > 0){
                 console.log(buf.slice(0, bytes).toString());
              }
     
              console.log("\n4. 关闭文件");
              fs.close(fd, function(err){
                 if (err){
                    console.log(err);
                 } 
                 console.log("4. 文件关闭成功！");
              });
           });
        });
     });
}

function file_info(file) {
    console.log("\n5. 查看input.txt状态");
    fs.stat(file, function (err, stats) {
        console.log(stats.isFile());         //true
        console.log(stats.isDirectory());    //false
    })
}

function file_delete(file) {
    console.log("\n6. 准备删除文件！");
    fs.unlink(file, function(err) {
       if (err) {
           return console.error(err);
       }
       console.log("6. 文件删除成功！");
    });
}

file="input.txt"
write(file);
file_read(file);
file_info(file);
//file_delete(file);

>>>
0. 准备写入文件

1. 准备打开已存在的文件！

5. 查看input.txt状态
1. 文件打开成功！

2. 截取10字节内的文件内容，超出部分将被去除。
true
false
2. 文件截取成功。

3. 读取文件输出
0. 数据写入成功！
我是通过 fs.writ

4. 关闭文件
4. 文件关闭成功！
```
